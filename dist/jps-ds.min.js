/*! jps-ds - v1.0.0 - 2014-06-26
* https://github.com/jonniespratley/ds
* Copyright (c) 2014 ; Licensed MIT */
!function(a){"use strict";a.DS=function(a){var b=require("mongoose"),c=require("q"),d=function(){return c.defer()},e=null,f={},g={};return g.connect=function(c){if(a.models)for(var d in a.models)if(d){var g=b.model(d,new b.Schema(a.models[d]));f[d]=g}return e=b.connect("mongodb://"+c),this},g.model=function(a,c){return b.model(a,new b.Schema(c))},g.findAll=function(a){var b=d();if(!f[a])throw new Error("Must add table to options.");return f[a].find(function(a,c){a?b.reject(a):b.resolve(c)}),b.promise},g.findOne=function(a,b){var c=d();if(!f[a])throw new Error("Must add table to options.");return f[a].findById(b,function(a,b){a?c.reject(a):c.resolve(b)}),c.promise},g.create=function(a,b){var c=d();if(!f[a])throw new Error("Must add table to options.");b._id&&delete b._id;var e=new f[a](b);return e.save(function(a,b){a?c.reject(a):c.resolve(b)}),c.promise},g.update=function(a,b,c){var e=d();return f[a].findByIdAndUpdate(b,c,function(a,b){a?e.reject(a):e.resolve(b)}),e.promise},g.destroy=function(a,b){var c=d();return f[a].findByIdAndRemove(b,function(a){a?c.reject(a):c.resolve(!0)}),c.promise},g.execute=function(a,b,d){if(!f[b])throw new Error("Must add table to options.");var e=f[b],g=c.defer();return console.log("calling on",b,a,d),g.resolve(e.call(a,d))},a.host?g.connect(a.host):g}}("object"==typeof exports&&exports||this);